import org.apache.tools.ant.filters.ReplaceTokens

apply plugin: 'distribution'

distributions {
    main {
        distributionBaseName = 'virgo-kernel'
        contents {
            from ( 'src/main/filtered' ) {
                include ( '**/*.properties' )
                include ( '**/*.plan' )
                include ( '**/.version' )
                filter(ReplaceTokens, tokens: tokenMap) // tokens are used in e.g. oev.kernel.userregion.properties
            }
            from ( 'src/main/filtered' ) {
                include ( 'bin/*.sh' )
                fileMode 0755
            }
            from ( "${buildDir}/VK/kernel/" ) { exclude ( 'Eclipse.app' ) }
            from ( "${buildDir}/common_resources/" )
        }
    }
}

tasks.register('publishVirgoKernel', PublishProduct) {
    product = 'kernel'
    productFileLocation = file("${projectDir}/publish_resources/products/${product}/${product}.product")
    javaProfileLocation = file("${projectDir}/src/main/dist/configuration/java-server.profile")
}

distZip.dependsOn(['publishVirgoKernel'])
